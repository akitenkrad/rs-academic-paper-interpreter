[config]
default_to_workspace = false

# ============ BUILD TASKS ============
[tasks.release-build]
description = "Build the project."
script = """cargo build --release"""

[tasks.dev-build]
description = "Build the project."
script = """cargo build"""

# ============ LINT TASKS ============
[tasks.format-all]
dependencies = ["sort-cargo-toml", "clippy", "reformat"]
description = "Format all code in the project."

[tasks.sort-cargo-toml]
description = "Sort the Cargo.toml files in the project."
install_crate = "taplo-cli"
script = """taplo fmt --option reorder_keys=true"""

[tasks.clippy]
args = ["clippy", "--all-targets", "--all-features", "--", "-D", "warnings"]
command = "cargo"
description = "Run clippy linter."

[tasks.reformat]
description = "Reformat the code using rustfmt."
script = """cargo fmt -- --emit files"""

# ============ TEST TASKS ============
[tasks.nextest-run]
dependencies = ["dev-build"]
description = "Run all tests in the project."
install_crate = "cargo-nextest"
install_crate_args = ["--locked"]
script = """cargo nextest run --workspace --status-level all --test-threads=1"""

[tasks.integration-test]
dependencies = ["dev-build"]
description = "Run all integration tests (requires API keys)."
install_crate = "cargo-nextest"
install_crate_args = ["--locked"]
script = """cargo nextest run --test integration_tests -- --ignored"""

[tasks.integration-test-openai]
dependencies = ["dev-build"]
description = "Run OpenAI integration tests."
install_crate = "cargo-nextest"
install_crate_args = ["--locked"]
script = """cargo nextest run --test integration_tests openai -- --ignored"""

[tasks.integration-test-anthropic]
dependencies = ["dev-build"]
description = "Run Anthropic integration tests."
install_crate = "cargo-nextest"
install_crate_args = ["--locked"]
script = """cargo nextest run --test integration_tests anthropic -- --ignored"""

[tasks.integration-test-ollama]
dependencies = ["dev-build"]
description = "Run Ollama integration tests (requires Ollama server)."
install_crate = "cargo-nextest"
install_crate_args = ["--locked"]
script = """cargo nextest run --test integration_tests ollama -- --ignored"""

[tasks.test-all]
dependencies = ["nextest-run", "integration-test"]
description = "Run all tests including integration tests."
